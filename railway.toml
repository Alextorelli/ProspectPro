# ProspectPro Railway Configuration
# Production-ready deployment with Supabase Transaction Pooler integration

[build]
builder = "NIXPACKS"
buildCommand = "npm ci --only=production"
watchPaths = ["server.js", "modules/**", "api/**", "public/**", "package.json"]

[deploy]
# Health check configuration for zero-downtime deployments
healthcheckPath = "/health"
healthcheckTimeout = 90
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
numReplicas = 1

# Production start command with optimized settings
startCommand = "node server.js"

# Sleep configuration for cost optimization  
sleepApplication = false  # Keep alive for production monitoring
staticUrl = true         # Enable static URL for consistent monitoring

# Environment variables (Railway will inject from project settings)
[environment]
NODE_ENV = "production"
# PORT is automatically provided by Railway - do not override

# Supabase Configuration Notes:
# Use Transaction Pooler URL format in Railway environment variables:
# SUPABASE_URL = "postgresql://postgres.[ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres"
# SUPABASE_SERVICE_ROLE_KEY = "sb_secret_your_key_here"
# SUPABASE_ANON_KEY = "your_anon_key_here"

# Resource monitoring and alerting
[observability]
enabled = true
alertOnHighCPU = true
alertOnHighMemory = true  
alertOnErrors = true

# Enable Railway's native analytics and cost monitoring
enableMetrics = true
enableLogs = true
logLevel = "info"

# Admin dashboard configuration
[admin]
# Custom admin dashboard available at /admin-dashboard.html
# Requires authentication via PERSONAL_ACCESS_TOKEN
dashboardPath = "/admin-dashboard.html"
enableBusinessMetrics = true
enableCostTracking = true
budgetAlerts = true