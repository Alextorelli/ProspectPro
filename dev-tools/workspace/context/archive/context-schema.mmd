%%{init: { "theme": "dark", "fontFamily": "Inter", "flowchart": { "htmlLabels": false, "curve": "monotoneX" } }}%%
flowchart TB
    subgraph ORCH["ðŸ§  Agent Orchestration"]
        direction TB
        AO["ðŸ¤– Agent Orchestrator"]
        CM["ðŸ—‚ï¸ Context Manager"]
        EM["ðŸŒ Environment Manager"]
    end

    subgraph AGENTS["ðŸ› ï¸ Specialized Agents"]
        direction LR
        DEV["ðŸ’» Dev Workflow"]
        OBS["ðŸ“ˆ Observability"]
        OPS["ðŸš€ Production Ops"]
        ARCH["ðŸ—ï¸ System Architect"]
    end

    subgraph MEMORY["ðŸ§  Memory & Context Store"]
        direction TB
        subgraph STORES["ðŸ“¦ Session Stores"]
            direction LR
            SCRATCH["ðŸ“ Scratchpad"]
            LTM["ðŸ—„ï¸ Long-term Memory"]
            CHKPT["ðŸ“¸ Checkpoints"]
        end
        subgraph SCHEMAS["ðŸ“ Schemas"]
            direction LR
            AGENT_CTX["ðŸ“„ Agent Context"]
            ENV_CTX["ðŸŒ Environment Context"]
            TASK_LED["ðŸ“‹ Task Ledger"]
        end
    end

    subgraph MCP["ðŸŒ MCP Mesh"]
        direction LR
        UT["ðŸ§° Utility MCP"]
        SUP["ðŸ—„ï¸ Supabase MCP"]
        GH["ðŸ“ GitHub MCP"]
        PW["ðŸ§ª Playwright MCP"]
        C7["ðŸ›°ï¸ Context7 MCP"]
    end

    subgraph SIGNALS["ðŸ“¡ Data & Telemetry"]
        direction TB
        PIPE["âš¡ Pipeline Signals"]
        TELEM["ðŸ“Š Release Telemetry"]
        LOGS["ðŸ“œ Execution Logs"]
    end

    %% Orchestration Flow
    CM -- "Stage Context" --> AO
    AO -- "Route Task" --> AGENTS
    
    %% Agent-specific workflows
    AO -- "Launch Build" --> DEV
    AO -- "Monitor Stack" --> OBS
    AO -- "Request Deploy" --> OPS
    AO -- "Design System" --> ARCH

    %% Agent â†’ MCP interactions
    DEV -- "Code Â· Test Â· Data" --> MCP
    OBS -- "Query Metrics" --> MCP
    OPS -- "Ship & Observe" --> MCP
    ARCH -- "Research Â· Design" --> MCP

    %% MCP â†’ Signals feedback
    MCP -- "Return Signals" --> PIPE
    MCP -- "Stream Telemetry" --> TELEM
    MCP -- "Capture Logs" --> LOGS

    %% Signals â†’ Orchestration loop
    PIPE -.-> AO
    TELEM -.-> CM
    LOGS -.-> OBS

    %% Context Management (bidirectional)
    CM <--> MEMORY
    AGENTS <.-> MEMORY
    EM <--> MEMORY

    %% MCP Utility provides memory/sequential/time
    UT -- "Memory Â· Sequential Â· Time" --> MEMORY
    MEMORY -- "Query Â· Checkpoint" --> UT

    %% Container-level relationships
    ORCH <--> AGENTS
    AGENTS <.-> MCP
    MCP <.-> SIGNALS
    SIGNALS <.-> ORCH
