%%{init: { "theme": "dark", "fontFamily": "Inter", "flowchart": { "htmlLabels": false, "curve": "monotoneX" } }}%%
flowchart LR
    subgraph OPS_FLOW["ğŸš€ Production Ops Agent"]
        direction TB
        OPS_START["ğŸš€ Start"]
        OPS_ORCH["ğŸ§  Orchestrator<br/>Request Deploy"]
        OPS_APPROVE["âœ‹ Human Approval<br/>Required"]
        OPS_MEM["ğŸ§  Load Context<br/>40 entries Â· Audit"]
        OPS_MCP["ğŸŒ MCP Mesh<br/>Ship & Observe"]
        OPS_SIG["ğŸ¯ Deploy Status<br/>ğŸ“Š Telemetry"]
        OPS_SAVE["ğŸ’¾ Checkpoint<br/>Pre/Post Deploy"]
        OPS_END["âœ… Complete"]
        
        OPS_START --> OPS_ORCH
        OPS_ORCH --> OPS_APPROVE
        OPS_APPROVE -- "Approved" --> OPS_MEM
        OPS_APPROVE -- "Rejected" -.-> OPS_END
        OPS_MEM --> OPS_MCP
        OPS_MCP --> OPS_SIG
        OPS_SIG --> OPS_SAVE
        OPS_SAVE --> OPS_END
        OPS_END -.-> OPS_START
    end

    subgraph OBS_FLOW["ğŸ“ˆ Observability Agent (Support)"]
        direction TB
        OBS_START["ğŸš€ Start"]
        OBS_ORCH["ğŸ§  Orchestrator<br/>Monitor Production"]
        OBS_MEM["ğŸ§  Load Context<br/>Read-Only"]
        OBS_MCP["ğŸŒ MCP Mesh<br/>Read Telemetry"]
        OBS_SIG["ğŸš¨ Incident Alerts<br/>ğŸ“Š Metrics"]
        OBS_SAVE["ğŸ’¾ Checkpoint<br/>Incident Only"]
        OBS_END["âœ… Complete"]
        
        OBS_START --> OBS_ORCH
        OBS_ORCH --> OBS_MEM
        OBS_MEM --> OBS_MCP
        OBS_MCP --> OBS_SIG
        OBS_SIG --> OBS_SAVE
        OBS_SAVE --> OBS_END
        OBS_SIG -- "Critical" ==> OPS_ORCH
        OBS_END -.-> OBS_START
    end

    subgraph SHARED["ğŸ”„ Shared Infrastructure"]
        direction TB
        ENV["ğŸš€ Production<br/>Read-Only Â· Approval Required"]
        CM["ğŸ—‚ï¸ Context Manager"]
        MEMORY["ğŸ§  Memory Store<br/>Deploy History Â· Configs Â· Audit"]
        MCP["ğŸŒ Restricted MCP<br/>Supabase (Deploy) Â· GitHub (PR) Â· Utility (RO)"]
    end

    OPS_FLOW -.-> SHARED
    OBS_FLOW -.-> SHARED
    SHARED -.-> OPS_FLOW
    SHARED -.-> OBS_FLOW

    style OPS_FLOW fill:#3a1a1a,stroke:#f87171,stroke-width:2px
    style OBS_FLOW fill:#2a1a3a,stroke:#a78bfa,stroke-width:2px,stroke-dasharray: 5 5
    style SHARED fill:#1a1a1a,stroke:#ef4444,stroke-width:2px
    style OPS_START fill:#7f1d1d,stroke:#f87171,stroke-width:3px
    style OBS_START fill:#4c1d95,stroke:#a78bfa,stroke-width:2px,stroke-dasharray: 5 5
    style OPS_END fill:#7f1d1d,stroke:#f87171,stroke-width:3px
    style OBS_END fill:#4c1d95,stroke:#a78bfa,stroke-width:2px,stroke-dasharray: 5 5
    style OPS_APPROVE fill:#854d0e,stroke:#fbbf24,stroke-width:3px
