%%{init: { "theme": "dark", "fontFamily": "Inter", "flowchart": { "htmlLabels": false, "curve": "monotoneX" } }}%%
flowchart TB
    subgraph ENV["ğŸ› ï¸ Development Environment"]
        direction TB
        ENV_LABEL["Unrestricted Â· Rapid Iteration Â· Full MCP Access"]
    end

    subgraph ORCH["ğŸ§  Agent Orchestration"]
        direction TB
        AO["ğŸ¤– Agent Orchestrator"]
        CM["ğŸ—‚ï¸ Context Manager"]
        EM["ğŸŒ Environment Manager"]
    end

    subgraph AGENTS["ğŸ‘¥ Active Agents"]
        direction LR
        DEV["ğŸ’» Dev Workflow<br/><i>Primary Agent</i>"]
        ARCH["ğŸ—ï¸ System Architect<br/><i>Design & Research</i>"]
    end

    subgraph MEMORY["ğŸ§  Memory & Context Store"]
        direction TB
        subgraph STORES["ğŸ“¦ Session Stores"]
            direction LR
            SCRATCH["ğŸ“ Scratchpad<br/><i>80 entries max</i>"]
            LTM["ğŸ—„ï¸ Long-term Memory<br/><i>Unlimited</i>"]
            CHKPT["ğŸ“¸ Checkpoints<br/><i>Auto-save enabled</i>"]
        end
        subgraph SCHEMAS["ğŸ“ Active Schemas"]
            direction LR
            AGENT_CTX["ğŸ“„ Agent Context"]
            ENV_CTX["ğŸŒ Environment Context"]
            TASK_LED["ğŸ“‹ Task Ledger"]
        end
    end

    subgraph MCP["ğŸŒ MCP Mesh - Full Access"]
        direction LR
        UT["ğŸ§° Utility MCP"]
        SUP["ğŸ—„ï¸ Supabase MCP"]
        GH["ğŸ“ GitHub MCP"]
        PW["ğŸ§ª Playwright MCP"]
        C7["ğŸ›°ï¸ Context7 MCP"]
    end

    subgraph SIGNALS["ğŸ“¡ Development Signals"]
        direction TB
        BUILD["ğŸ”¨ Build Signals"]
        TEST["âœ… Test Results"]
        DESIGN["ğŸ“ Design Decisions"]
    end

    %% Orchestration Flow
    ENV_LABEL -.-> EM
    CM -- "Stage Dev Context" --> AO
    AO -- "Route to Dev/Arch" --> AGENTS
    
    %% Agent-specific workflows
    AO -- "Launch Build Cycle" --> DEV
    AO -- "Design System" --> ARCH

    %% Agent â†’ MCP interactions (unrestricted)
    DEV -- "Code Â· Test Â· Data Â· Deploy Local" --> MCP
    ARCH -- "Research Â· Design Â· Prototype" --> MCP

    %% MCP â†’ Signals feedback
    MCP -- "Build Status" --> BUILD
    MCP -- "Test Coverage" --> TEST
    MCP -- "Design Artifacts" --> DESIGN

    %% Signals â†’ Orchestration loop
    BUILD -.-> AO
    TEST -.-> DEV
    DESIGN -.-> ARCH

    %% Context Management (bidirectional, high frequency)
    CM <--> MEMORY
    AGENTS <===> MEMORY
    EM <--> MEMORY

    %% MCP Utility provides core services
    UT -- "Memory Â· Sequential Â· Time" --> MEMORY
    MEMORY -- "Frequent Checkpoints" --> UT

    %% Container-level relationships
    ORCH <--> AGENTS
    AGENTS <==> MCP
    MCP <.-> SIGNALS
    SIGNALS <.-> ORCH

    style DEV fill:#2d5016,stroke:#4ade80,stroke-width:3px
    style ARCH fill:#1e3a5f,stroke:#60a5fa,stroke-width:3px
    style ENV_LABEL fill:#065f46,stroke:#10b981,stroke-width:2px
