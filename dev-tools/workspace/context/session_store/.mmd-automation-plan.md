# Mermaid Automation Program â€” Status & Execution Plan (2025 Update)

## Current Status

- âœ… Working docs, config, and guidelines scaffolded under `docs/tooling/` and `docs/mmd-shared/`.
- âœ… Domain buckets and MECE index established under `docs/diagrams/{dev-tools,app-source,integration}`.
- âœ… Core automation scripts refactored and validated:
  - `update-indexes.mjs` â€” regenerates diagram index and live-tooling-list
  - `validate-mermaid-diagrams.sh` â€” lints and validates all diagrams
  - `run-mermaid-automation.sh` â€” orchestrates index update, diagram generation, validation, and (in CI) auto-staging/committing
  - `scaffold-diagrams.sh` â€” scaffolds missing diagrams per MECE index
  - `check-tags.mjs` â€” enforces taxonomy and tag compliance
- ðŸš§ Diagram migration and full CI integration in progress.

## Automation Workflow

1. **Index & Inventory**: `update-indexes.mjs` runs first to update the MECE index and tooling list from all `.mmd` files and inventories.
2. **Diagram Generation**: (Optional) `generate-diagrams.mjs` for local change tracking; VS Code handles preview, not SVG export.
3. **Validation**: `validate-mermaid-diagrams.sh` and `check-tags.mjs` ensure all diagrams are linted and tagged per taxonomy.
4. **Orchestration**: `run-mermaid-automation.sh` is the main entry for CI and pre-commit, running all above steps and auto-committing only in CI.
5. **Scaffolding**: `scaffold-diagrams.sh` is used for onboarding and taxonomy expansion, not in every CI run.

## CI & Pre-commit Integration

- `.husky/pre-commit` runs ignore config validation and mermaid automation in validation mode only (no auto-staging).
- `docs-automation.yml` (main branch) and `mermaid-diagram-sync.yml` (PRs) both trigger diagram normalization, validation, and auto-commit rendered diagrams as needed.
- Only CI jobs should stage/commit changes; local runs are validation-only.

## Provenance & Documentation

- Provenance and coverage are logged in `dev-tools/workspace/context/session_store/coverage.md` after major diagram or automation changes.
- All script and config references are kept current in the MECE index and live-tooling-list.
- Documentation standards, diagram guidelines, and taxonomy rules are maintained in `docs/tooling/diagram-guidelines.md` and related working docs.

## Next Steps

1. Complete diagram migration and update reciprocal links in the MECE index.
2. Finalize CI integration and ensure all automation steps are covered in docs jobs.
3. Expand taxonomy doc with explicit tag syntax, placement rules, and sample preflight output.
4. Update provenance logs and inventories after each major change.

## Open Questions

- Should SVG export remain opt-in for local runs, or be enforced in CI?
- Is a grace period needed for legacy diagrams before strict taxonomy enforcement?
