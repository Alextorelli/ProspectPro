# Mermaid Automation Program â€” Status & Execution Plan

## Current Status
- âœ… Scaffolded working docs and folders under `docs/tooling/` (config, guidelines, snippets, workflow, taxonomy, MECE index, agent + CI playbooks).
- âœ… Domain buckets created under `docs/diagrams/{dev-tools,app-source,integration}`.
- ðŸš§ Script refactor, taxonomy preflight, CI job, and diagram migration remain outstanding.

## Strategy Overview
1. **Centralized Theme** â€” `docs/tooling/mermaid.config.json` drives global styling; generation script must consume it.
2. **Pattern Guides** â€” `docs/tooling/diagram-guidelines.md` outlines domain patterns and references reusable anchors in `docs/tooling/snippets/mermaid.json` (e.g., `ZeroFakeData`).
3. **Generation Pipeline** â€” Merge existing patch/generate tooling into `docs/scripts/generate-diagrams.sh` with `--init-config` support, config injection, `npx @mermaid-js/mermaid-cli -p` lint, and optional SVG export via `RENDER_STATIC=true`.
4. **Taxonomy & Reporting** â€” `docs/tooling/diagram-taxonomy.md` will define tag syntax (`%% domain:dev-tools %%`, compliance anchors) and preflight expectations; running `npm run docs:prepare` should emit a missing-tag report and open Mermaid preview.
5. **MECE Index** â€” `docs/tooling/end-state/index.md` maintains reciprocal links across all diagrams, grouped by domain and type.
6. **Agent/MCP Hooks** â€” `docs/tooling/agent-integration.md` captures the normalization MCP tool (`diagram_patch`), VS Code task to invoke `MermaidChart.createDiagram`, and logging of provenance into `dev-tools/workspace/context/session_store/coverage.md`.
7. **CI Enforcement** â€” `docs/tooling/ci-integration.md` guides `.github/workflows/docs-validation.yml`, gated on existing docs jobs to reuse installs/caches.

## Optimization Directives
- Add acceptance criteria (owner, success signal, dependencies) at the top of each working doc so automation work is trackable.
- Extend `diagram-taxonomy.md` with explicit tag syntax, placement rules, and sample preflight output.
- Wire the refactored generation script into `npm run docs:prepare` and CI to ensure lint/taxonomy checks run automatically.
- After diagram relocation and MCP tooling updates, record provenance in `coverage.md`.
- Ensure the docs validation workflow reuses cached dependencies from existing docs-related GitHub Actions steps.

## Execution Checklist
1. **Scripts**
   - [ ] Consolidate patch and generation scripts into `docs/scripts/generate-diagrams.sh` with config injection + lint.
   - [ ] Update `package.json` (`docs:prepare`, `docs:render:svg`, etc.) to use the new pipeline and expose the `RENDER_STATIC` flag.
2. **Documentation Enhancements**
   - [ ] Add acceptance criteria headers to: `diagram-guidelines.md`, `generation-workflow.md`, `diagram-taxonomy.md`, `agent-integration.md`, `ci-integration.md`, `end-state/index.md`.
   - [ ] Expand taxonomy doc with tag syntax, required anchors, and enforcement rules.
3. **Diagram Migration**
   - [ ] Relocate existing `.mmd` assets into `docs/diagrams/{dev-tools,app-source,integration}` and embed taxonomy tags.
   - [ ] Populate `docs/tooling/end-state/index.md` with reciprocal links once migration completes.
4. **Tooling & CI**
   - [ ] Register the `diagram_patch` MCP tool and expose VS Code tasks per `agent-integration.md`.
   - [ ] Author `.github/workflows/docs-validation.yml` (lint + taxonomy audit) and gate it on current docs jobs.
5. **Provenance Logging**
   - [ ] Update `dev-tools/workspace/context/session_store/coverage.md` after diagram migration + MCP tooling changes.

## Open Questions
- Do we require a grace period for legacy diagrams, or can taxonomy enforcement be immediate?
- Should SVG export run automatically in CI, or remain opt-in for local runs via env flag?

## Next Review Gate
- Reassess once the generation script + CI workflow land to ensure linting, taxonomy validation, and MECE index population are automated end-to-end.
