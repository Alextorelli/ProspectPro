%% compliance: %%
%% domain: dev-tools %%
%% reciprocal: [docs/diagrams/dev-tools/architecture/workflow.mmd] %%
%% type: architecture %%
%% title: Environment MCP Contexts %%
%% index: [docs/tooling/end-state/index.md] %%
%%{init: { 'theme': 'dark', 'flowchart': { 'defaultRenderer': 'elk', 'elk': { 'algorithm': 'layered', 'direction': 'DOWN', 'spacing.nodeNode': '50' }}}}%%
flowchart TD
    subgraph Environments["Environment Contexts"]
        Production{{"Production<br/>Write ops • Deploy • Logs"}}
        Development{{"Development<br/>Write ops • Tests • No deploy"}}
        Troubleshooting{{"Troubleshooting<br/>Read only • Diagnostics"}}
    end

    subgraph Platform["Core Platform Tools"]
        subgraph DataLayer["Data Layer"]
            SupabaseDB[("Supabase DB<br/>RLS • Query tooling")]
            DrizzleORM["Drizzle ORM<br/>Migrations • Schema safety"]
        end

        subgraph ComputeLayer["Compute Layer"]
            EdgeFunctions["Edge Functions<br/>Deploy • Test • Monitor"]
            TestSuite["Test Suite<br/>Unit • Integration • E2E"]
        end
    end

    subgraph Integrations["External Integrations"]
        subgraph Discovery["Discovery APIs"]
            GooglePlaces(["Google Places<br/>Business discovery"])
            Foursquare(["Foursquare<br/>Venue data"])
        end
        
        subgraph Enrichment["Enrichment APIs"]
            HunterIO(["Hunter.io<br/>Email discovery"])
            NeverBounce(["NeverBounce<br/>Verification"])
            CobaltIntel(["Cobalt Intelligence<br/>Business filings"])
        end
    end

    subgraph DevOps["DevOps & CI/CD"]
        CICDPipeline["CI/CD Pipeline<br/>Lint • Test • Security"]
        VercelDeploy["Vercel Deploy<br/>Frontend releases"]
    end

    Production --> SupabaseDB
    Production --> EdgeFunctions
    Production --> VercelDeploy

    Development --> DrizzleORM
    Development --> TestSuite
    Development --> CICDPipeline

    Troubleshooting --> SupabaseDB
    Troubleshooting --> EdgeFunctions

    EdgeFunctions --> GooglePlaces
    EdgeFunctions --> Foursquare
    EdgeFunctions --> HunterIO
    EdgeFunctions --> NeverBounce
    EdgeFunctions --> CobaltIntel
    
    TestSuite --> SupabaseDB
    CICDPipeline --> VercelDeploy
