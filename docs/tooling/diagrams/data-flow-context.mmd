
%% config: theme: dark, layout: dagre
flowchart TD
	A[VS Code Chat Input] --> B{Parse @mention Pattern}
	B --> |@debug| C[Debug Agent Handler]
	B --> |@deliver| D[Deliver Agent Handler]
	B --> |@support| E[Support Agent Handler]
	B --> |@research| F[Research Agent Handler]
	B --> |@optimize| G[Optimize Agent Handler]
	B --> |Multiple @agents| H[Coordination Manager]

	subgraph Context Manager
		CM1[Workspace Context]
		CM2[Historical Context]
		CM3[External Context]
	end

	CM1 --> N1[Persona-Specific MCP Bundle]
	CM2 --> N1
	CM3 --> N1

	N1 --> C
	N1 --> D
	N1 --> E
	N1 --> F
	N1 --> G

	C --> C1[Load Smart Debug Mode]
	D --> D1[Load Feature Delivery Mode]
	E --> E1[Load Production Support Mode]
	F --> F1[Load API Research Mode]
	G --> G1[Load Cost Optimization Mode]

	...existing code...
