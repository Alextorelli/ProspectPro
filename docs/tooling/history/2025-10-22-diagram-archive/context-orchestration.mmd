---
id: context-orchestration
intent: Context Orchestration Sequence (modular, agentic, with stable node IDs)
context: |
  Sequence diagram showing context update flow: agent triggers, validation, orchestration, and checkpointing. Uses shared snippet blocks for node consistency.
---
sequenceDiagram
    participant AGENT as Agent Orchestrator\n(dev-tools/agent-orchestration/agents/)
    participant CMGR as Context Manager\n(scripts/context/event-bus.ts)
    participant ZFD as ZeroFakeData Checkpoint\n(scripts/shell/zero-fake-data-check.sh)
    participant FN as Edge Function\n(app/backend/functions/context-orchestration)
    participant DB as Supabase DB\n(supabase/schema-sql/001_core_schema.sql)
    participant CACHE as Cache Layer\n(scripts/context/cache-session.js)
  participant LOG as Diagnostics Logger\n(scripts/diagnostics/edge-function-diagnostics.sh)
  participant OTEL as OTEL Collector\n(telemetry/otel)

    AGENT->>CMGR: dispatch: contextUpdate
    CMGR->>ZFD: validate (ZeroFakeData)
    ZFD-->>CMGR: pass/fail
    CMGR->>FN: orchestrateContext
    FN->>DB: read/write: contextState
    FN->>CACHE: cache: sessionContext
    FN->>LOG: log: orchestrationEvent
  FN->>OTEL: emit telemetry (capture_api_trace, cost, ROI)
    FN-->>AGENT: orchestrationResult

    %% Validation checkpoint
  Note over FN,OTEL: Telemetry & Validation\n- Tools: capture_api_trace, compare_campaign_costs, predict_campaign_roi\n- Validate: ZeroFakeData, cost, ROI\n- Log: orchestration diagnostics, OTEL traces

