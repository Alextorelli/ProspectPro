%%{init: {'theme': 'dark'}}%%
sequenceDiagram
    participant Developer
    participant Prompt as Copilot Prompt
    participant Router as Agent Router
    participant Coordinator as Coordination Manager
    participant Env as Environment Router
    participant Scripts as Automation Scripts
    participant Agent as Selected Agent
    participant MCP as MCP Clusters

    Developer->>Prompt: Activate agent mode
    Prompt->>Router: Submit context & intent
    Router-->>Prompt: Mode classification
    Router->>Coordinator: Transfer mode details
    Coordinator-->>Router: Confirm participants
    Coordinator->>Env: Request environment matrix
    Env-->>Coordinator: Return scoped environment
    Coordinator->>Agent: Brief selected agent
    par Automation pipeline
        Coordinator->>Scripts: Run lint/tests/docs suite
        Scripts-->>Coordinator: Report execution status
    and Telemetry
        Coordinator->>MCP: Invoke troubleshooting tools
        MCP-->>Coordinator: Return telemetry results
    end
    Coordinator->>Agent: Compile outcomes
    Agent-->>Developer: Surface recommendations