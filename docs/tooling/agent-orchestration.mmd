%% Agent Orchestration Workflow
%% accTitle: Agent Orchestration Workflow
%% accDescr: Top-down flow from request intake through planning, routing, execution, and feedback outputs
%% Palette: mcp #2563eb, agent #f97316, workflow #16a34a, context #64748b, output #facc15
flowchart TD
	subgraph Intake["Intake"]
		direction LR
		Request["Developer / AI Request"]:::agent
	end

	subgraph Orchestration["Orchestrate"]
		direction LR
		Plan["Plan Tasks"]:::workflow
		Ledger["Update Ledger"]:::context
		ContextMgr["Manage Context"]:::context
	end

	subgraph Routing["Route"]
		direction LR
		SkillRouter["Route Skills"]:::agent
	end

	subgraph Execution["Execute"]
		direction LR
		AgentPool["Agent Pool"]:::agent
		MCPBridge["Invoke MCP"]:::mcp
	end

	subgraph Outcomes["Outcome"]
		direction LR
		Deliverable["Deliver Result"]:::output
	end

	Request --> Plan
	Plan --> Ledger
	Ledger --> ContextMgr
	ContextMgr --> SkillRouter
	SkillRouter --> AgentPool
	AgentPool --> MCPBridge
	MCPBridge --> Deliverable
	Deliverable -.->|"feedback"| Request
	MCPBridge --> Ledger

	classDef mcp fill:#2563eb,color:#fff;
	classDef agent fill:#f97316,color:#fff;
	classDef workflow fill:#16a34a,color:#fff;
	classDef context fill:#64748b,color:#fff;
	classDef output fill:#facc15,color:#222;

	subgraph Legend["Legend"]
		direction LR
		L1["MCP"]
		L2["Agent"]
		L3["Workflow"]
		L4["Context"]
		L5["Output"]
		style Legend fill:#fff,stroke:#888,stroke-width:1px
		style L1 fill:#2563eb,color:#fff
		style L2 fill:#f97316,color:#fff
		style L3 fill:#16a34a,color:#fff
		style L4 fill:#64748b,color:#fff
		style L5 fill:#facc15,color:#222
	end

